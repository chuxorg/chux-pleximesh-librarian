# LIB-002 â€” Implement Canonical Artifact Schema & Read API

## Status
Planned

## Objective

Implement the **canonical artifact schema** and **read-only Librarian REST API** as the authoritative retrieval mechanism for all intent artifacts.

This task establishes the Librarian as a **production-grade, read-optimized authority** for agents and humans.

---

## Scope

### In Scope

- MongoDB schema creation
- Index enforcement
- Read-only REST API implementation
- Deterministic artifact resolution
- Checksum verification on read

### Out of Scope

- Authentication / authorization
- Write APIs (except seed import)
- UI integration
- Permissions
- Search

---

## Canonical Data Model

### Collection: `artifacts`

Required fields:

- `artifact_id` (string)
- `kind` (task | policy | phase | law | report | schema)
- `domain` (engineering | governance | librarian | ui | runtime)
- `version` (vN, immutable)
- `status` (planned | active | deprecated | archived)
- `content_type` (text/markdown | application/yaml | application/json)
- `content` (string)
- `checksum` (sha256)
- `metadata` (object, optional)
- `links` (object, optional)
- `source` (seed-import | api-write | migration)
- `created_at`
- `effective_at`

Uniqueness constraint:


(artifact_id, version)


---

### Collection: `artifact_events`

Append-only audit log capturing:

- `artifact.created`
- `artifact.imported`
- `artifact.deprecated`
- `artifact.superseded`
- `artifact.wired`

Each event MUST include:
- timestamp
- actor
- artifact_id
- version
- reason

---

## REST API (Read-Only)

### Endpoints

- `GET /artifacts/{artifact_id}`
  - Returns latest active version
- `GET /artifacts/{artifact_id}?version=vX`
- `GET /tasks/{task_id}`
- `GET /policies/{policy_id}`
- `GET /phases/{phase_id}`
- `GET /artifacts?kind=&domain=&status=&tag=`

### Rules

- Exact version resolution only
- No fallback logic
- Checksum verified on every read
- Deterministic serialization

---

## Acceptance Criteria

1. Mongo collections and indexes are created
2. Artifacts are retrievable by ID and version
3. Latest active version resolves deterministically
4. Checksum is verified on read
5. ENG-UI-001 is retrievable via API
6. No filesystem access required for reads

---

## Notes

This task establishes **read-path correctness first**.
All subsequent work builds on this invariant.
